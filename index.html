<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="magnifier_styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&family=Special+Elite&display=swap" rel="stylesheet">

  <title>The Remains of That Summer</title>
</head>

<body>

  <!-- Landing Page -->
  <div id="landingPage">
    <h1 id="landingTitle">THE REMAINS OF THAT SUMMER</h1>
    <button id="enterButton">&lt; Enter &gt;</button>
  </div>

  <!-- Background music -->
  <audio id="backgroundMusic" loop autoplay>
    <source src="sound/bbc_ocean.mp3" type="audio/mpeg">
  </audio>

  <div class="flipbook">
    
<!-- +++++++++++++ SECTION BELOW PG1-10 +++++++++++++ -->
    <div class="coverFront">
      <img src="bookAllPg/pg_01.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_02.png" alt="" />
    </div>
    
    <div class="bookAllPgR">
      <img src="bookAllPg/pg_03.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_04.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_05.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_06.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_07.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_08.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_09.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_10.png" alt="" />
    </div>

<!-- +++++++++++++ SECTION BELOW PG11-20 +++++++++++++ -->
    <div class="bookAllPgR">
      <img src="bookAllPg/pg_11.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_12.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_13.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_14.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_15.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_16.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_17.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_18.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_19.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_20.png" alt="" />
    </div>

<!-- +++++++++++++ SECTION BELOW PG21-30 +++++++++++++ -->
    <div class="bookAllPgR">
      <img src="bookAllPg/pg_21.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_22.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_23.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_24.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_25.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_26.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_27.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_28.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_29.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_30.png" alt="" />
    </div>

<!-- +++++++++++++ SECTION BELOW PG31-40 +++++++++++++ -->
    <div class="bookAllPgR">
      <img src="bookAllPg/pg_31.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_32.png" alt="" />
    </div>
    
    <div class="bookAllPgR">
      <img src="bookAllPg/pg_33.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_34.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_35.png" alt="" />
    </div>
  
    <div class="bookAllPgL">
      <img src="bookAllPg/pg_36.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_37.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_38.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_39.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_40.png" alt="" />
    </div>

<!-- +++++++++++++ SECTION BELOW PG41-50 +++++++++++++ -->
    <div class="bookAllPgR">
      <img src="bookAllPg/pg_41.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_42.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_43.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_44.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_45.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_46.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_47.png" alt="" />
    </div> 

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_48.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_49.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_50.png" alt="" />
    </div>

<!-- +++++++++++++ SECTION BELOW PG51-60 +++++++++++++ -->
    <div class="bookAllPgR">
      <img src="bookAllPg/pg_51.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_52.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_53.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_54.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_55.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_56.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_57.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_58.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_59.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_60.png" alt="" />
    </div>
    
<!-- +++++++++++++ SECTION BELOW PG61-70 +++++++++++++ -->
    <div class="bookAllPgR">
      <img src="bookAllPg/pg_61.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_62.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_63.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_64.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_65.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_66.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_67.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_68.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_69.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_70.png" alt="" />
    </div>

<!-- +++++++++++++ SECTION BELOW PG71-82 +++++++++++++ -->
    <div class="bookAllPgR">
      <img src="bookAllPg/pg_71.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_72.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_73.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_74.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_75.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_76.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_77.png" alt="" />
    </div>

    <div class="bookAllPgL">
      <img src="bookAllPg/pg_78.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_79.png" alt="" />
    </div>
    
    <div class="bookAllPgL">
      <img src="bookAllPg/pg_80.png" alt="" />
    </div>

    <div class="bookAllPgR">
      <img src="bookAllPg/pg_81.png" alt="" />
    </div>

    <div class="coverBack">
      <img class="cover"src="bookAllPg/pg_82.png" alt="" />  
    </div>

  </div>

<!-- Add navigation buttons below the flipbook -->
  <div class="navigation">
      <button class="nav-button left-button" aria-label="Previous page">&larr;</button>

      <!-- Add a label for the slider -->
      <label for="page-slider" class="visually-hidden">Page Slider</label>
      <input 
          type="range" 
          id="page-slider" 
          class="page-slider" 
          min="1" 
          max="82" 
          value="1" 
          title="Slide to navigate pages" 
      />
      <button class="nav-button right-button" aria-label="Next page">&rarr;</button>
  </div>

<!-- Add letter -->
  <a href="letter.html" target="_blank" id="letterBox" title="OPEN LETTER">
    <img id="letterCover" src="bookAllPg/letterCover.png" alt="" />
    <span id="letterTooltip">
      In case if you see this letter, <br>
      You may double click to open <br>
      OR disregard it.</span>
  </a>

  <!-- Magnifying glass -->
  <div id="magnifier">
    <div id="magnifierLens"></div>
  </div>

  <!-- Magnifier toggle button -->
  <button id="magnifierToggle" aria-label="Toggle magnifier">üîç</button>

  <script src="jquery.js"></script>
  <script src="turn.js"></script>
  
  <script>
    // Landing page logic
    const landingPage = document.getElementById('landingPage');
    const enterButton = document.getElementById('enterButton');
    const landingTitle = document.getElementById('landingTitle');

    // Fade in the title
    setTimeout(() => {
      landingTitle.style.opacity = '1';
    }, 500);

    // Show enter button after title appears
    setTimeout(() => {
      enterButton.style.opacity = '1';
    }, 2500);

    // Handle enter button click
    enterButton.addEventListener('click', () => {
      landingPage.style.opacity = '0';
      setTimeout(() => {
        landingPage.style.display = 'none';
      }, 1000);
    });

    document.getElementById('backgroundMusic').volume = 0.6; // 60% volume

    document.querySelectorAll('img').forEach(img => {
    img.setAttribute('draggable', 'false');
    img.setAttribute('oncontextmenu', 'return false;');
    img.setAttribute('ondragstart', 'return false;');
    });
    
    // Prevent right-click on images
    document.addEventListener('contextmenu', (e) => {
        if (e.target.tagName === 'IMG') {
            e.preventDefault();
            return false;
        }
    });
    
    // Prevent drag and drop of images
    document.addEventListener('dragstart', (e) => {
        if (e.target.tagName === 'IMG') {
            e.preventDefault();
            return false;
        }
    });
    
    // Allow keyboard navigation with arrow keys
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
            e.preventDefault();
            $('.flipbook').turn('previous');
        } else if (e.key === 'ArrowRight') {
            e.preventDefault();
            $('.flipbook').turn('next');
        }
    });
    
    let hasSeenPage76 = false;
    
    $(".flipbook").turn({
      turnCorners: "tl,tr,bl,br",
      cornerSize: 150,
      acceleration: true,
      autoCenter: true,
      when: {
          turning: function(event, page) {
              console.log("Turning to page:", page); // Debugging log
              
              // Show letterBox after user has seen page 76
              if (page >= 76 && !hasSeenPage76) {
                  hasSeenPage76 = true;
                  const letterBox = document.getElementById('letterBox');
                  letterBox.style.display = 'block';
                  setTimeout(() => {
                      letterBox.classList.add('show');
                  }, 50);
              }
          }
      }
   }); 
  </script>
  
  <script>
    const slider = document.querySelector('.page-slider');
    const flipbook = $(".flipbook");
    const leftButton = document.querySelector('.left-button');
    const rightButton = document.querySelector('.right-button');

    slider.addEventListener('input', (event) => {
        const page = parseInt(event.target.value, 10);
        flipbook.turn('page', page);
    });

    // Update the slider when the page changes
    flipbook.on('turning', (event, page) => {
        slider.value = page;
    });

    // Navigate backward by 1 page
    leftButton.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        flipbook.turn('previous');
    });

    // Navigate forward by 1 page
    rightButton.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        flipbook.turn('next');
    });
</script>

<!-- Star Background -->
<script>
  let starCount = 30; // Initial number of stars
  let timeOnPage = 0; // Track time on page in seconds

  function createNewStar() {
    var newStarText = document.createElement('div');
    newStarText.id = 'starNew' + Math.random(); // Give id
    newStarText.innerText = '*'; 

    // Add styles to the star
    newStarText.style.position = 'absolute';
    newStarText.style.color = 'darkslategray';
    newStarText.style.fontSize = '20px';
    newStarText.style.zIndex = '-1'; // Make it in the background

    document.body.appendChild(newStarText);

    function moveRandomly() {
        var left = Math.random() * (window.innerWidth - newStarText.offsetWidth);
        var top = Math.random() * (window.innerHeight - newStarText.offsetHeight);
        newStarText.style.left = left + 'px';
        newStarText.style.top = top + 'px';
    }

    moveRandomly(); // Initial position
    setInterval(moveRandomly, 1500); // Change position every 1.5 sec
  }

  // Create initial stars
  for (let i = 0; i < starCount; i++) {
      createNewStar();
  }

  // Gradually add more stars as user stays longer
  setInterval(() => {
      timeOnPage++;
      
      // Add 1 new star every 10 seconds (up to a maximum of 200 stars)
      if (timeOnPage % 10 === 0 && starCount < 200) {
          starCount++;
          createNewStar();
      }
  }, 1000); // Check every second

  // Magnifier toggle button functionality
  const magnifierToggle = document.getElementById('magnifierToggle');
  const magnifier = document.getElementById('magnifier');
  let magnifierVisible = false;

  magnifierToggle.addEventListener('click', () => {
      magnifierVisible = !magnifierVisible;
      magnifier.style.display = magnifierVisible ? 'block' : 'none';
      
      // Reset position when showing
      if (magnifierVisible) {
          magnifier.style.left = '';
          magnifier.style.top = '';
          magnifier.style.right = '20px';
          magnifier.style.bottom = '90px';
      }
  });

  // Magnifying glass functionality
  const magnifierLens = document.getElementById('magnifierLens');
  const flipbookElement = document.querySelector('.flipbook');
  let isMagnifying = false;
  let magnifierOffsetX, magnifierOffsetY;

  magnifier.addEventListener('mousedown', (e) => {
      isMagnifying = true;
      magnifierOffsetX = e.clientX - magnifier.getBoundingClientRect().left;
      magnifierOffsetY = e.clientY - magnifier.getBoundingClientRect().top;
      e.preventDefault();
  });

  document.addEventListener('mousemove', (e) => {
      if (isMagnifying) {
          const x = e.clientX - magnifierOffsetX;
          const y = e.clientY - magnifierOffsetY;
          magnifier.style.left = x + 'px';
          magnifier.style.top = y + 'px';
          magnifier.style.right = 'auto';
          magnifier.style.bottom = 'auto';
      }

      // Update magnification effect
      const magnifierRect = magnifier.getBoundingClientRect();
      const magnifierCenterX = magnifierRect.left + magnifierRect.width / 2;
      const magnifierCenterY = magnifierRect.top + magnifierRect.height / 2;
      
      // Use document.elementFromPoint to get the actual topmost element at magnifier position
      let targetImage = null;
      
      // Temporarily hide magnifier to check what's underneath
      magnifier.style.pointerEvents = 'none';
      const elementAtPoint = document.elementFromPoint(magnifierCenterX, magnifierCenterY);
      magnifier.style.pointerEvents = 'auto';
      
      // Check if the element is an image or find the closest image
      if (elementAtPoint) {
          if (elementAtPoint.tagName === 'IMG') {
              // Direct hit on image
              const parent = elementAtPoint.parentElement;
              if (parent && (parent.classList.contains('bookAllPgL') || 
                            parent.classList.contains('bookAllPgR') || 
                            parent.classList.contains('coverFront') || 
                            parent.classList.contains('coverBack'))) {
                  targetImage = elementAtPoint;
              }
          } else {
              // Check if it's a page container
              let container = elementAtPoint;
              while (container && !container.classList.contains('bookAllPgL') && 
                     !container.classList.contains('bookAllPgR') && 
                     !container.classList.contains('coverFront') && 
                     !container.classList.contains('coverBack')) {
                  container = container.parentElement;
                  if (!container || container === document.body) break;
              }
              
              if (container) {
                  const img = container.querySelector('img');
                  if (img) {
                      const imgRect = img.getBoundingClientRect();
                      // Verify magnifier is over the image
                      if (magnifierCenterX >= imgRect.left && magnifierCenterX <= imgRect.right &&
                          magnifierCenterY >= imgRect.top && magnifierCenterY <= imgRect.bottom) {
                          targetImage = img;
                      }
                  }
              }
          }
      }
      
      if (targetImage) {
          const imgRect = targetImage.getBoundingClientRect();
          
          // Calculate relative position within the image (0-1)
          const relX = (magnifierCenterX - imgRect.left) / imgRect.width;
          const relY = (magnifierCenterY - imgRect.top) / imgRect.height;
          
          // Set background position for magnification
          const bgPosX = relX * 100;
          const bgPosY = relY * 100;
          
          magnifierLens.style.backgroundImage = `url(${targetImage.src})`;
          magnifierLens.style.backgroundPosition = `${bgPosX}% ${bgPosY}%`;
          magnifierLens.style.backgroundSize = `${imgRect.width * 3}px ${imgRect.height * 3}px`; // 3x magnification
      } else {
          magnifierLens.style.backgroundImage = 'none';
      }
  });

  document.addEventListener('mouseup', () => {
      if (isMagnifying) {
          isMagnifying = false;
      }
  });

  // Helper function to get current page image
  function getCurrentPageImage() {
      const currentPage = flipbook.turn('page');
      const pageElement = flipbookElement.querySelector(`.p${currentPage} img`);
      return pageElement ? pageElement.src : '';
  }

  // Make letterBox draggable
  const letterBox = document.getElementById('letterBox');
  let isDragging = false;
  let hasMoved = false;
  let offsetX, offsetY;

  letterBox.addEventListener('mousedown', (e) => {
      isDragging = true;
      hasMoved = false;
      offsetX = e.clientX - letterBox.getBoundingClientRect().left;
      offsetY = e.clientY - letterBox.getBoundingClientRect().top;
      letterBox.style.cursor = 'grabbing';
      e.preventDefault(); // Prevent link from being followed while dragging
  });

  document.addEventListener('mousemove', (e) => {
      if (isDragging) {
          hasMoved = true;
          letterBox.style.left = (e.clientX - offsetX) + 'px';
          letterBox.style.top = (e.clientY - offsetY) + 'px';
      }
  });

  document.addEventListener('mouseup', () => {
      if (isDragging) {
          isDragging = false;
          letterBox.style.cursor = 'grab';
      }
  });

  // Open on double-click only
  letterBox.addEventListener('click', (e) => {
      e.preventDefault(); // Prevent default link behavior
  });

  letterBox.addEventListener('dblclick', (e) => {
      if (!hasMoved) {
          window.open('letter.html', '_blank');
      }
      e.preventDefault();
  });
</script>

</body>

</html>